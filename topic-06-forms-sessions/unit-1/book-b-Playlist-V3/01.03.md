## Playlists hinzufügen

Nachdem wir nun Songs zu unseren vorhandenen Playlists hinzufügen können, wollen wir nun auch ganze Playlists neu erstellen können.
Dies geschieht nun nach dem gleichen Prinzip, wie soeben bei den Songs gesehen. 

### Partial mit Formular
Implementieren Sie wieder zuerst ein Partial View mit dem Formular in einer neuen Datei `addplaylist.hbs` im `partials` Ordner.
~~~ html
    <div class="border p-2 my-2">
    <form action="/dashboard/addplaylist" method="POST">
        <div class="mb-3">
            <label for="inputTitle" class="form-label">Title</label>
            <input placeholder="Title" type="text" class="form-control" id="inputTitle" name="title">
        </div>
        <button type="submit" class="btn btn-primary">Add Playlist</button>
</div>
~~~

### Integration im View
Das Formular können Sie dann in Ihrem Dashboard (`dashboard.hbs`) integrieren.
~~~ hbs
    {{>addplaylist}}
~~~

### Routing anpassen
Auch das Playlist Formular arbeitet mit einem Post-Request an eine URL, die bisher noch nicht in unseren Routen definiert ist.
Ergänzen Sie daher folgende Zeile in unserem Router:
~~~ js
    router.post('/dashboard/addplaylist', dashboard.addPlaylist);
~~~

### Controller ergänzen
Wie Sie an dem Routing schon erkennen können, soll das Ergänzen von Playlists über den Dashboard Controller laufen (Siehe Funktionsaufruf).
Die verantwortliche Methode soll `addPlaylist` heißen und sieht wie folgt aus:
~~~ js
async addPlaylist(request, response) {
    const newPlayList = {
        title: request.body.title,
    };
    logger.debug("Creating a new Playlist", newPlayList);
    await playlistStore.addPlaylist(newPlayList);
    response.redirect("/dashboard");
}
~~~

### Model anpassen

Wie auch für das Hinzufügen von Songs wird auch für das Anlegen von neuen Playlists eine Schnittstelle in die Datenbank erfordert,
die im Model nun integriert werden muss. Dem Controller sehen Sie dabei bereits an, dass im `playlistStore` eine Funktion `addPlaylist(playlist)` aufgerufen wird, die aber noch nicht im Model vorhanden ist.

Ergänzen Sie deswegen im Model folgende Funktionalität:
~~~ js
  async addPlaylist(playList) {
    try {
      const query = 'INSERT INTO playlist_playlists (TITLE) VALUES($1)';
      const values = [playList.title];
      await dataStoreClient.query(query, values);
    } catch (e) {
      logger.error("Error cannot add playlist", e);
    }
  },
~~~

Testen Sie nun das Erstellen von Playlists.
Ihnen sollte dabei in der Konsole folgendes Problem auffallen:
![img_3.png](img/img_3.png)

Die Fehlermeldung sagt, Ihnen dass der Titel der Playlist, den Sie im Formular definiert haben, nicht eingelesen werden konnte.
Dies liegt darin, dass Ihr Controller keinerlei direkten Zugriff auf die Attribute Ihres Views hat.

Das lässt sich mit einem neuen Model aber sehr einfach lösen.

Für den Zugriff auf den body eines requests gibt es den "Body Parser".
Diesen haben Sie bereits innerhalb des ersten Labs mit `npm install` installiert, sodass dieser nun direkt genutzt werden kann.

Innerhalb der  `App.js` müssen Sie für die Nutzung des Paketes folgende Zeile am Anfang ergänzen:
~~~ js
const bodyParser = require("body-parser")
~~~

Und darunter in selbiger Datei mit folgender Zeile konfigurieren:
~~~ js
app.use(bodyParser.urlencoded({extended: false}));
~~~
So weiß Ihre App, dass das "Body Parser" Modul genutzt werden soll und das Anlegen von Playlists sollte möglich sein.
Verifizieren Sie dies, indem Sie erneut versuchen eine Playlist zu ergänzen. Prüfen Sie dann auch, ob Sie zu dieser neuen Playlist einen neuen Song ergänzen können.
